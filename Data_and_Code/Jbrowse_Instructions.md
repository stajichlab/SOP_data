Jbrowser SOP

Written by: Tania Kurbessoian


You created all these BAM and vcf files but now you want to visualize them onto a browser. The Jbrowse option I would say is easy and really customizable to what you want to visualize.

Let’s start with their website.   https://jbrowse.org
They have a really good documentation tab that goes into depth about how to install and add in features. Their FAQ section is also incredibly helpful. 
I git cloned this into my bigdata/ folder.  (20 seconds)
git clone https://github.com/gmod/jbrowse 



Initially I had this jbrowse folder in my home/.html/ directory but because the home directory is limited in space I did a sym link. The jbrowse folder is located in my bigdata/ folder. Then from home I: 
cd into .html/ then ln -s ../bigdata/jbrowse  this way I have more space to play with.
As you are in the jbrowse folder run 
git checkout 1.16.9-release
Now set the environment up with - 
Conda activate nodejs 
If you don’t have this conda environment up yet, make sure to set it up with:
First create the environment
Using:
Conda create -n (XXX)

Then activate the newly created environment.
Source activate (XXX)

Install it from the bioconda.
Conda install -c bioconda (XXX)
 
Now run 
            ./setup.sh (this will take 10 minutes to run)

Open up your cluster page and see if it worked.

Here is my cluster page. https://cluster.hpcc.ucr.edu/~tkurb001/ 

		
Click on jbrowse2 to take you to the newly made page. 
            This will take a couple of seconds. It will say “Loading…” But once done it should say,   “Congratulations! Jbrowse is now on the web!”
Though you have no data loaded in so it’ll give you an error. You can look at the volvox dataset they have preinstalled. 
But now you can start setting up your own browser!
Now let’s set up the browser!
mkdir data/ this is where all your files will live.
Sym link your annotated fasta file into your data folder.
Module load samtools
samtools faidx your_fasta_file.fasta to create your indexed fasta file.
Now in order to have this appear on your browser you need to edit a file. Jbrowse gives you two options to edit an html file or just a text configuration file. 
trackList.json - html file
Tracks.conf - text file
Personally I just worked through the text file and not the json file because I wasn’t too familiar with html. You can literally just edit the text file through nano.
Now that you have your reference file and it’s indexed add this to your tracks.conf file. Replace my sequence names with yours. 
[GENERAL]
refSeqs=Exophiala_dermatitidis_Ex4.fa.fai

[tracks.refseq]
urlTemplate=Exophiala_dermatitidis_Ex4.fa
storeClass=JBrowse/Store/SeqFeature/IndexedFasta
type=Sequence
You can also add in a gff3 file, it’s the same as your annotated reference though, especially when you add it to your browser, but this is how you do it. Add this to tracks.conf file
[tracks.genes]
urlTemplate=Exophiala_dermatitidis_Ex4.sorted.gff3.gz
storeClass=JBrowse/Store/SeqFeature/GFF3Tabix
type=CanvasFeatures
Let’s add in your bam files now. Again just sym link your bam files from wherever they are into the data file. Unfortunately the cluster disallows the bam files to appear. 
In your data file you should create the file .htaccess. 
It may be created on its own or you may have to create one yourself. If not add this into your .htaccess file.
/# This Apache .htaccess file is generated by JBrowse (GenomeDB) for
/# allowing cross-origin requests as defined by the Cross-Origin
/# Resource Sharing working draft from the W3C
/# (http://www.w3.org/TR/cors/).  In order for Apache to pay attention
/# to this, it must have mod_headers enabled, and its AllowOverride
/# configuration directive must allow FileInfo overrides.
<IfModule mod_headers.c>
    Header onsuccess set Access-Control-Allow-Origin *
    Header onsuccess set Access-Control-Allow-Headers X-Requested-With,Range
    Header onsuccess set Access-Control-Expose-Headers Content-Length,Content-Range
</IfModule>

In order to get the bam files to appear on your browser add this to tracks.conf file.
[ tracks . EX1_bam ]
style.height = 7
key = BAM - Ex1-sorted.bam
storeClass = JBrowse/Store/SeqFeature/BAM
urlTemplate = Ex1.realign.sorted.bam
maxFeatureScreenDensity = 4
metadata.category = BAM
metadata.Description = BAM-format alignments of simulated resequencing reads on Ex1
type = JBrowse/View/Track/Alignments2
renderAlignment = true

If you have more than one file they should look like this
[ tracks . EX2_bam ]
style.height = 7
key = BAM - Ex2-sorted.bam
storeClass = JBrowse/Store/SeqFeature/BAM
urlTemplate = Ex2.realign.sorted.bam            
maxFeatureScreenDensity = 4
metadata.category = BAM
metadata.Description = BAM-format alignments of simulated resequencing reads on Ex2                            
type = JBrowse/View/Track/Alignments2
renderAlignment = true

Follow the suggestions for your files, adjust the names and you’re good to go.
Now if you want to add vcf files, again sym link them into your data file. And add this to your tracks.conf file. 
[tracks. INDEL_VCF]
style.height = 7
storeClass=JBrowse/Store/SeqFeature/VCFTabix
urlTemplate=Exophiala.Run1.selected.INDEL.vcf.gz
maxFeatureScreenDensity = 4
metadata.category = VCF
type = JBrowse/View/Track/CanvasVariants
key = VCF - INDEL

[tracks.SNP_VCF]
style.height = 7
storeClass=JBrowse/Store/SeqFeature/VCFTabix
urlTemplate=Exophiala.Run1.selected.SNP.vcf.gz
maxFeatureScreenDensity	= 4
metadata.category = VCF
type = JBrowse/View/Track/CanvasVariants
key = VCF - SNPs

I’ve added a track for both SNPs and INDELs. If you’ve run Jason’s full GATK pipeline you’ll get these two files from snpEff. I’ve added the gz file Exophiala.Run1.selected.INDEL.vcf.gz
And Exophiala.Run1.selected.SNP.vcf.gz. You should also index these files using:
tabix -p vcf my_file.vcf.gz

I recommend you chmod 777 your data/ folder and all the files that exist in the data/ file. 
Now refresh your page and your browser should appear!
